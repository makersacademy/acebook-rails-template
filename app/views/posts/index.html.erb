<p id=”notice”><%= notice %></p>
<% if current_user %>
  Logged in as <%= current_user.username %>.
  <%= link_to 'Log Out', logout_path %>
  <%= link_to 'My Profile', profile_path %>
<% else %>
  <%= link_to 'Sign Up', signup_path %> or 
  <%= link_to 'Log In', login_path %>
<% end %>

<% if current_user %>
  <%= form_for @post do |form| %>        
      <div class="field">
        <%= form.label :message %>
        <%= form.text_area :message, :cols => 50, :rows => 5 %>
      </div>
      <div class="actions">
        <%= form.submit %>
      </div>
    <% end %>
<% end %>
<p>This is a test</p>
<% @posts.each do |post| %>
<br>
 <% our_user = User.find(post[:user_id]) %>
 <%= our_user[:username] %>
  <p><%= simple_format post.message %></p>
  <%=post.created_at.to_formatted_s(:long)%>
  <% if can? :edit, post %>
    <%= link_to 'Edit', edit_post_path(post) %>
  <% end %>
  <% if can? :destroy, post %>
    <%= link_to 'Delete', post_path(post), method: :delete, data: { :confirm => "Are you sure?" } %>
  <% end %>

  <% if current_user %>
    <%= form_for @comment do |form| %>     
      <input hidden value="<%= post.id %>" name="post_id">    
      <div class="field">
        <%= form.label :comment %>
        <%= form.text_area :comment, :cols => 50, :rows =>2 %>
      </div>
      <div class="actions">
        <%= form.submit %>
      </div>
    <% end %>
  <% end %>

  <% @comments.each do |comment| %>
    <% if comment.post_id == post.id %>
      <% our_user = User.find(comment[:user_id]) %>
      <%= our_user[:username] %>
      <p><%= simple_format comment.comment %></p>
      <%=comment.created_at.to_formatted_s(:long)%>
      <% if can? :edit, comment %>
        <%= link_to 'Edit', edit_comment_path(comment), id: "edit-comment" %>
      <% end %>
      <% if can? :destroy, comment %>
        <%= link_to 'Delete', comment_path(comment), method: :delete, data: { :confirm => "Are you sure?" }, id: "delete-comment" %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
<br>
